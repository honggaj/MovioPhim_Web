<!-- Skeleton Loading -->
<div *ngIf="isLoading" class="animate-pulse space-y-6">
  <div class="w-full h-64 sm:h-80 md:h-96 bg-zinc-700 dark:bg-zinc-800 rounded-xl"></div>

  <div class="space-y-3">
    <div class="h-8 bg-zinc-700 dark:bg-zinc-800 rounded w-3/4"></div>
    <div class="h-4 bg-zinc-600 dark:bg-zinc-700 rounded w-1/2"></div>
    <div class="h-4 bg-zinc-600 dark:bg-zinc-700 rounded w-full"></div>
    <div class="h-4 bg-zinc-600 dark:bg-zinc-700 rounded w-5/6"></div>
    <div class="h-4 bg-zinc-600 dark:bg-zinc-700 rounded w-2/3"></div>
  </div>

  <div class="grid grid-cols-5 gap-4 mt-6">
    <div *ngFor="let i of [1,2,3,4,5]" class="h-48 bg-zinc-700 dark:bg-zinc-800 rounded-lg"></div>
  </div>
</div>

<div *ngIf="!isLoading">
  <div class="min-h-screen py-4 rounded
              bg-white text-gray-900
              dark:bg-black dark:text-white">
    <div class="max-w-screen-lg mx-auto px-4 space-y-10">

      <!-- Poster + Thumb -->
      <div class="relative w-full h-64 sm:h-80 md:h-96 overflow-hidden shadow-lg">
        <img [src]="'https://img.ophim.live/uploads/movies/' + movie.item.poster_url"
          class="w-full h-full object-cover rounded-t-sm" [alt]="movie.item.name + ' poster'" />
        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent "></div>
        <div class="absolute inset-0 flex items-center justify-center">
          <img [src]="'https://img.ophim.live/uploads/movies/' + movie.item.thumb_url"
            class="w-32 md:w-40 lg:w-44 rounded-xl shadow-2xl ring-2 ring-white/10 hover:scale-105 transition-transform duration-300" />
        </div>
      </div>

      <!-- Info -->
      <div class="space-y-3">
<h1 class="text-4xl font-extrabold tracking-wide
           text-transparent bg-clip-text
           bg-gradient-to-r from-red-600 to-orange-400">
  {{ movie?.item?.name }}
</h1>

        <p class="text-gray-600 dark:text-gray-400 text-sm">
          {{ movie?.item?.origin_name }} ‚Ä¢ {{ movie?.item?.year }} ‚Ä¢ {{ movie?.item?.time }}
        </p>

        <p class="text-gray-600 dark:text-gray-400 text-sm">
          {{ movie?.item?.lang }} ‚Ä¢ {{ movie?.item?.quality }} ‚Ä¢
          {{ movie?.item?.episode_current }} / {{ movie?.item?.episode_total }}
        </p>

        <div class="text-base leading-relaxed text-gray-700 dark:text-gray-300" [innerHTML]="movie?.item?.content">
        </div>

        <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1 mt-4">
          <p><strong class="text-gray-900 dark:text-white">ƒê·∫°o di·ªÖn:</strong> {{ movie?.seoOnPage?.seoSchema?.director
            || 'ƒêang c·∫≠p nh·∫≠t' }}</p>
          <p><strong class="text-gray-900 dark:text-white">Ng√†y ph√°t h√†nh:</strong> {{
            movie?.seoOnPage?.seoSchema?.datePublished | date:'dd/MM/yyyy' }}</p>
          <p><strong class="text-gray-900 dark:text-white">Th·ªÉ lo·∫°i:</strong> {{ getBreadCrumbNames('the-loai') }}</p>
          <p><strong class="text-gray-900 dark:text-white">Qu·ªëc gia:</strong> {{ getBreadCrumbNames('quoc-gia') }}</p>
        </div>
      </div>
      <!-- üé≠ Di·ªÖn vi√™n -->
      <div>

        <p-carousel *ngIf="castList && castList.length > 0" [value]="castList" [numVisible]="10" [numScroll]="8"
          [circular]="true" [autoplayInterval]="3000" [responsiveOptions]="responsiveOptions" [showIndicators]="false"
          [showNavigators]="true" styleClass="custom-carousel">
          [autoplayInterval]="3000" [responsiveOptions]="responsiveOptions" [showIndicators]="false"
          [showNavigators]="true" styleClass="custom-carousel">
          <ng-template pTemplate="item" let-actor>
            <h2 class="text-2xl font-semibold mb-3">Di·ªÖn vi√™n</h2>
            <div class="text-center p-2">
              <img [src]="'https://image.tmdb.org/t/p/w185' + actor.profile_path" (error)="onImgError($event)"
                [alt]="actor.name"
                class="rounded-lg w-full h-auto mb-2 object-cover aspect-[2/3] shadow-lg ring-1 ring-white/10" />
              <p class="font-semibold text-sm">{{ actor.name }}</p>
              <p class="text-xs text-gray-400">{{ actor.character }}</p>
            </div>
          </ng-template>
        </p-carousel>
      </div>
      <!-- Buttons -->
      <div class="grid grid-cols-2 gap-4">
        <button *ngIf="movie?.item?.episodes?.[0]?.server_data?.length"
          (click)="setEpisode(movie.item.episodes[0].server_data[0]?.link_embed)"
          class="bg-red-600 hover:bg-red-700 px-6 py-2.5 rounded text-white font-semibold transition duration-200 shadow-md">
          ‚ñ∂ Xem phim
        </button>

        <button *ngIf="movie?.item?.trailer_url" (click)="toggleTrailer()"
          class="bg-zinc-700 hover:bg-zinc-600 dark:bg-zinc-800 dark:hover:bg-zinc-700 px-6 py-2.5 rounded text-white font-semibold transition duration-200 shadow-md">
          üé¨ Xem trailer
        </button>
      </div>


      <!-- üé¨ Trailer -->
      <div *ngIf="showTrailer && movie?.item?.trailer_url">
        <h2 class="text-xl font-semibold mb-2">Trailer</h2>
        <iframe [src]="movie?.item?.trailer_url | youtubeEmbed" frameborder="0" allowfullscreen
          class="w-full aspect-video rounded-xl shadow-lg">
        </iframe>
      </div>

      <!-- üì∫ Video Player -->
      <div *ngIf="selectedEpisodeLink">
        <h2 class="text-xl font-semibold mb-2">ƒêang xem</h2>
        <iframe [src]="selectedEpisodeLink | safeUrl" frameborder="0" allowfullscreen
          class="w-full aspect-video rounded-xl shadow-lg">
        </iframe>
      </div>

      <!-- üéûÔ∏è Danh s√°ch t·∫≠p -->
      <div *ngIf="movie?.item?.episodes?.[currentSeasonIndex]?.server_data?.length">
        <h2 class="text-xl font-semibold mb-2 mt-4">Danh s√°ch t·∫≠p</h2>
        <div class="grid grid-cols-4 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-3">
          <button *ngFor="let ep of movie.item.episodes[currentSeasonIndex].server_data"
            (click)="setEpisode(ep.link_embed)"
            class="w-full px-3 py-2 bg-zinc-800 rounded-md hover:bg-zinc-700 text-sm transition text-center"
            [ngClass]="{ 'bg-zinc-700 text-red-500': selectedEpisodeLink === ep.link_embed }">
            T·∫≠p {{ ep.name }}
          </button>
        </div>
      </div>

      <!-- Related movies -->
      <div *ngIf="relatedMovies.length > 0">
        <div class="flex items-center justify-between mb-4">
          <h2 class="mb-4 border-b-2 border-red-600 pb-2
           bg-gradient-to-r from-red-500 to-yellow-400
           transition-all duration-300 ease-in-out
           text-transparent bg-clip-text cursor-pointer
           font-extrabold text-xl drop-shadow-md">
            <img src="assets/icon/tv_show.gif" alt="Anime Icon" class="inline-block w-10 h-10 mr-2" />
            Phim b·ªô
          </h2>
<app-movie-randome></app-movie-randome>        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 bg-black rounded">
          <a *ngFor="let movie of relatedMovies" [routerLink]="['/phim', movie.slug]" class="relative text-white bg-zinc-900 shadow rounded overflow-hidden block cursor-pointer
             hover:bg-zinc-800 transition duration-300">

            <div class="absolute top-0 left-1 z-10">
              <span
                class="bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white text-[10px] px-2 py-1 rounded shadow">
                {{ movie.quality }} + {{ movie.lang }}
              </span>
            </div>

            <div class="overflow-hidden relative">
              <img [src]="'https://img.ophim.live/uploads/movies/' + movie.thumb_url" [alt]="movie.name"
                class="w-full h-40 object-cover rounded-t transform transition duration-300 hover:scale-105" />

              <div *ngIf="movie.episode_current" class="absolute bottom-1 right-1 z-10">
                <span class="bg-gradient-to-r from-red-600 to-orange-500 hover:from-red-700 hover:to-orange-600
 text-white text-[10px] px-2 py-1 rounded shadow">
                  {{ movie.episode_current }}
                </span>
              </div>
            </div>

            <div class="p-2">
              <h3 class="text-sm font-semibold truncate">{{ movie.name }}</h3>
              <p class="text-xs text-gray-400 truncate">{{ movie.origin_name }}</p>
            </div>

            <div class="space-x-2 px-2 py-2">
              <span class="inline-block bg-gray-300 text-gray-600 text-[10px] px-2 py-1 rounded">
                {{ movie.category[0]?.name }}
              </span>
              <span class="inline-block bg-gray-300 text-gray-600 text-[10px] px-2 py-1 rounded">
                {{ movie.year }}
              </span>
            </div>
          </a>
        </div>
      </div>


    </div>
  </div>
</div>